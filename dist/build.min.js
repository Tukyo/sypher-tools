const WindowModule={pageFocus:function(){const e="visible"===document.visibilityState;return e?console.log("Page Focused..."):console.log("Page Unfocused..."),e}},TruncationModule={truncate:function(e,t=6,r=4){if("string"!=typeof e)throw new TypeError('TruncationModule.truncate: "string" must be a valid string but received '+typeof e);if(!Number.isInteger(t)||t<0)throw new RangeError(`TruncationModule.truncate: "startLength" must be a non-negative integer but received ${t}`);if(!Number.isInteger(r)||r<0)throw new RangeError(`TruncationModule.truncate: "endLength" must be a non-negative integer but received ${r}`);return e.length<=t+r+3?e:`${e.slice(0,t)}...${e.slice(-r)}`},truncateBalance:function(e,t=2,r=8){if("number"!=typeof e||isNaN(e))throw new TypeError(`TruncationModule.truncateBalance: "balance" must be a valid number but received ${e}`);if(!Number.isInteger(t)||t<0)throw new RangeError(`TruncationModule.truncateBalance: "decimals" must be a non-negative integer but received ${t}`);if(!Number.isInteger(r)||r<=0)throw new RangeError(`TruncationModule.truncateBalance: "maxLength" must be a positive integer but received ${r}`);const n=parseFloat(e);if(n>=1e15)return`${(n/1e15).toFixed(t)}Q`;if(n>=1e12)return`${(n/1e12).toFixed(t)}T`;if(n>=1e9)return`${(n/1e9).toFixed(t)}B`;if(n>=1e6)return`${(n/1e6).toFixed(t)}M`;if(n>=1e3)return`${(n/1e3).toFixed(t)}K`;const[o,a=""]=n.toString().split(".");if(o.length>=r)return o;const s=r-o.length-1,i=a.slice(0,Math.max(s,0));return i?`${o}.${i}`:o}},InterfaceModule={toggleLoader:function(e,t=!0,r,n=""){e&&(e.innerHTML=t?r:n)},parallax:function(){const e=document.querySelectorAll("[data-speed]");function t(){e.forEach((e=>{const t=parseFloat(e.dataset.speed)||.5,r=window.scrollY*t;e.style.transform=`translateY(${-r}px)`}))}window.addEventListener("scroll",(function(){requestAnimationFrame(t)})),t()},fade:function(e="20px",t="0.5s"){const r=document.querySelectorAll("[data-fade]");if(0===r.length)return;r.forEach((r=>{r.style.opacity=0,r.style.transform=`translateY(${e})`,r.style.transition=`opacity ${t} ease-out, transform ${t} ease-out`}));const n=new IntersectionObserver((t=>{t.forEach((t=>{const r=t.target;t.isIntersecting&&t.intersectionRatio>.1?(r.style.opacity=1,r.style.transform="translateY(0)"):(r.style.opacity=0,r.style.transform=`translateY(${e})`)}))}),{threshold:.1});r.forEach((e=>n.observe(e)))}},CryptoInterfaceModule={createConnectButton:function(e=document.body,t=()=>sypher.Connect("ethereum"),r="Connect Wallet"){if("function"!=typeof t)return;const n=document.createElement("button");n.classList.add("connect-button"),n.textContent=r,n.onclick=t,e.appendChild(n)}},CHAINLINK_ABI=["function latestRoundData() view returns (uint80 roundId, int256 answer, uint256 startedAt, uint256 updatedAt, uint80 answeredInRound)"],ERC20_ABI=["function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)","function name() view returns (string)","function symbol() view returns (string)","function totalSupply() view returns (uint256)","function transfer(address to, uint256 amount) returns (bool)"],UNISWAP_V2_POOL_ABI=["function getReserves() view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast)","function token0() view returns (address)","function token1() view returns (address)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 value) returns (bool)","function transfer(address to, uint256 value) returns (bool)","function transferFrom(address from, address to, uint256 value) returns (bool)"],UNISWAP_V3_POOL_ABI=["function slot0() view returns (uint160 sqrtPriceX96, int24 tick, uint16 observationIndex, uint16 observationCardinality, uint16 observationCardinalityNext, uint8 feeProtocol, bool unlocked)","function token0() view returns (address)","function token1() view returns (address)","function fee() view returns (uint24)","function decimals() view returns (uint8)","function liquidity() view returns (uint128)"],CHAINS={ethereum:{params:[{chainId:"0x1",chainName:"Ethereum",nativeCurrency:{name:"Ethereum",symbol:"ETH",decimals:18},rpcUrls:["https://eth.llamarpc.com"],blockExplorerUrls:["https://etherscan.io"]}],priceFeeds:{eth:"0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70"},pairAddresses:{eth:"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2"}},arbitrum:{params:[{chainId:"0xa4b1",chainName:"Arbitrum",nativeCurrency:{name:"Arbitrum",symbol:"ETH",decimals:18},rpcUrls:["https://arbitrum.llamarpc.com"],blockExplorerUrls:["https://arbiscan.io"]}],priceFeeds:{eth:"0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612",arb:"0xb2A824043730FE05F3DA2efaFa1CBbe83fa548D6"},pairAddresses:{eth:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",arb:"0xB50721BCf8d664c30412Cfbc6cf7a15145234ad1"}},optimism:{params:[{chainId:"0xa",chainName:"Optimism",nativeCurrency:{name:"Optimism",symbol:"ETH",decimals:18},rpcUrls:["https://optimism.llamarpc.com"],blockExplorerUrls:["https://optimistic.etherscan.io"]}],priceFeeds:{eth:"0xb7B9A39CC63f856b90B364911CC324dC46aC1770",op:"0x0D276FC14719f9292D5C1eA2198673d1f4269246"},pairAddresses:{eth:"0x4200000000000000000000000000000000000006",op:"0x4200000000000000000000000000000000000042"}},base:{params:[{chainId:"0x2105",chainName:"Base",nativeCurrency:{name:"Base",symbol:"ETH",decimals:18},rpcUrls:["https://mainnet.base.org"],blockExplorerUrls:["https://basescan.org"]}],priceFeeds:{eth:"0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70"},pairAddresses:{eth:"0x4200000000000000000000000000000000000006"}},polygon:{params:[{chainId:"0x89",chainName:"Polygon",nativeCurrency:{name:"Polygon",symbol:"POL",decimals:18},rpcUrls:["https://polygon.llamarpc.com"],blockExplorerUrls:["https://polygonscan.com"]}],priceFeeds:{eth:"0xF9680D99D6C9589e2a93a78A04A279e509205945",matic:"0xAB594600376Ec9fD91F8e885dADF0CE036862dE0"},pairAddresses:{eth:"0x11CD37bb86F65419713f30673A480EA33c826872",matic:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270"}},avalanche:{params:[{chainID:"0xa86a",chainName:"Avalanche",nativeCurrency:{name:"Avalanche",symbol:"AVAX",decimals:18},rpcUrls:["https://avalanche.drpc.org"],blockExplorerUrls:["https://snowtrace.io"]}],priceFeeds:{eth:"0x976B3D034E162d8bD72D6b9C989d545b839003b0",avax:"0x0A77230d17318075983913bC2145DB16C7366156"},pairAddresses:{eth:"",avax:""}},fantom:{params:[{chainId:"0xfa",chainName:"Fantom",nativeCurrency:{name:"Fantom",symbol:"FTM",decimals:18},rpcUrls:["https://rpc.ftm.tools"],blockExplorerUrls:["https://ftmscan.com"]}],priceFeeds:{eth:"0x11DdD3d147E5b83D01cee7070027092397d63658",ftm:"0xf4766552D15AE4d256Ad41B6cf2933482B0680dc"},pairAddresses:{eth:"",ftm:""}}},CryptoModule={initCrypto:async function(e,t,r,n,o="eth"){if(!await this.connect(e))return null;console.log("Getting details for:",{chain:e,contractAddress:t,poolAddress:r,version:n,pair:o});const{balance:a,decimals:s,name:i,symbol:c}=await this.getTokenDetails(t);let l=null;"V2"===n&&(l=await this.getPriceV2(e,r,o)),"V3"===n&&(l=await this.getPriceV3(e,t,r,o));const u=this.getUserValue(a,l);return this.clean({contractAddress:t,poolAddress:r,balance:a,decimals:s,name:i,symbol:c,tokenPrice:l,userValue:u})},connect:async function(e){if(window.ethereum)try{const t=await window.ethereum.request({method:"eth_requestAccounts"});return console.log("Accounts:",t),await this.switchChain(e),t[0]?(console.log("Wallet connected..."),t[0]):(console.log("Wallet not connected..."),null)}catch(e){return console.error("Connection error:",e),null}},switchChain:async function(e){if(!window.ethereum)return;const t=CHAINS[e].params[0].chainId;if(!t)return;if(await window.ethereum.request({method:"eth_chainId"})!==t)try{console.log(`Switching to ${e} chain...`),await window.ethereum.request({method:"wallet_switchEthereumChain",params:CHAINS[e].params})}catch(t){console.log("Switch error:",t),4902===t.code&&(console.log(`Adding ${e} chain...`),await window.ethereum.request({method:"wallet_addEthereumChain",params:CHAINS[e].params}))}},getPricefeed:async function(e,t="eth"){if(!window.ethereum)return null;if(!(e in CHAINS))return null;try{const r=CHAINS[e].priceFeeds[t];if(!r)throw new Error(`Chain ${e} is not supported`);const n=new ethers.providers.Web3Provider(window.ethereum).getSigner(),o=new ethers.Contract(r,CHAINLINK_ABI,n),a=await o.latestRoundData(),s=ethers.utils.formatUnits(a.answer,8);return console.log(`ETH Price on ${e}: $${s}`),s}catch(e){return console.error("Error getting ETH price:",e),null}},getTokenDetails:async function(e){if(!window.ethereum)return null;if(!e)return null;try{const t=new ethers.providers.Web3Provider(window.ethereum).getSigner(),r=await t.getAddress(),n=new ethers.Contract(e,ERC20_ABI,t),o=await n.balanceOf(r),a=await n.decimals(),s=await n.name();return{balance:o,decimals:a,name:s,symbol:await n.symbol()}}catch(e){return console.error("Error getting balance:",e),null}},getPriceV2:async function(e,t,r){if(!window.ethereum)return null;if(!t)return null;if(!(e in CHAINS))return null;try{const n=await this.getPricefeed(e,r);if(!n)return null;const o=new ethers.providers.Web3Provider(window.ethereum).getSigner(),a=new ethers.Contract(t,UNISWAP_V2_POOL_ABI,o),s=await a.token0(),i=await a.token1(),c=await a.getReserves(),l=c._reserve0,u=c._reserve1,d=new ethers.Contract(s,ERC20_ABI,o),m=new ethers.Contract(i,ERC20_ABI,o),h=await d.decimals(),f=await m.decimals();console.log("Reserve 0:",l),console.log("Reserve 1:",u),console.log("Token 0:",s),console.log("Token 1:",i),console.log("Decimals 0:",h),console.log("Decimals 1:",f);const p=ethers.BigNumber.from(l),w=ethers.BigNumber.from(u),g=parseFloat(ethers.utils.formatUnits(p,h)),b=parseFloat(ethers.utils.formatUnits(w,f)),C=CHAINS[e].pairAddresses[r];console.log("Pair Address:",C);let y=null;if(i.toLowerCase()===C.toLowerCase())y=b/g;else{if(s.toLowerCase()!==C.toLowerCase())return console.log(`Skipping pool ${t} - Neither token is ${r}`),null;y=g/b}const A=y*n;return console.log(`V2 Price for token in pool ${t}: $${A}`),A}catch(e){return console.error("Error calculating V2 token price:",e),null}},getPriceV3:async function(e,t,r,n){if(!window.ethereum)return null;if(!r||!t)return null;if(!(e in CHAINS))return null;try{const{sqrtPriceX96:o,token0:a,token1:s,decimals0:i,decimals1:c}=await this.getPoolV3(t,r),l=CHAINS[e].pairAddresses[n];console.log("Pair Address:",l);const u=ethers.BigNumber.from(o),d=ethers.BigNumber.from("79228162514264337593543950336"),m=u.mul(u).mul(ethers.BigNumber.from(10).pow(i)),h=d.mul(d).mul(ethers.BigNumber.from(10).pow(c)),f=m.div(h),p=m.mod(h),w=8,g=ethers.BigNumber.from(10).pow(w),b=p.mul(g).div(h),C=parseFloat(f.toString())+parseFloat(b.toString())/Math.pow(10,w);let y;if(s.toLowerCase()===l.toLowerCase())y=C;else{if(a.toLowerCase()!==l.toLowerCase())return console.log(`Skipping pool ${r} - Neither token is ${n}`),null;y=1/C}const A=await this.getPricefeed(e);if(!A)return null;const v=y*parseFloat(A);return console.log(`V3 Price for token in pool ${r}: $${v}`),v}catch(e){return console.error("Error calculating V3 token price:",e),null}},getPoolV3:async function(e,t){if(!window.ethereum)return null;if(!t||!e)return null;try{const e=new ethers.providers.Web3Provider(window.ethereum).getSigner(),r=new ethers.Contract(t,UNISWAP_V3_POOL_ABI,e),n=(await r.slot0()).sqrtPriceX96;console.log("Sqrt Price X96:",n);const o=await r.token0(),a=await r.token1();console.log("Token 0:",o),console.log("Token 1:",a);const s=new ethers.Contract(o,ERC20_ABI,e),i=new ethers.Contract(a,ERC20_ABI,e),c=await s.decimals(),l=await i.decimals();console.log("Decimals 0:",c),console.log("Decimals 1:",l);const u=await r.liquidity();return console.log("Liquidity:",u),{sqrtPriceX96:n,token0:o,token1:a,decimals0:c,decimals1:l,liquidity:u}}catch(e){return console.error("Error getting pool data:",e),null}},getUserValue:function(e,t){if(!e||!t)return null;try{const r=parseFloat(e)*parseFloat(t);return console.log(`User Value: ${r}`),r}catch(e){return console.error("Error calculating user value:",e),null}},clean:function(e){if(!window.ethereum)return null;if(!e)return null;const{contractAddress:t,poolAddress:r,balance:n,decimals:o,name:a,symbol:s,tokenPrice:i,userValue:c}=e,l={contractAddress:t,poolAddress:r,balance:parseFloat(ethers.utils.formatUnits(n,o)),decimals:o,name:a,symbol:s,tokenPrice:parseFloat(i),userValue:(parseFloat(c)/Math.pow(10,o)).toFixed(o)};return console.log("Token Details:",l),l}};!function(e){const t={};Object.assign(t,WindowModule),Object.assign(t,TruncationModule),Object.assign(t,InterfaceModule),Object.assign(t,CryptoModule),Object.assign(t,CryptoInterfaceModule),e.sypher=t,console.log("Sypher Modules Initialized!")}(window);