const WindowModule={pageFocus:function(){const e="visible"===document.visibilityState;return e?console.log("Page Focused..."):console.log("Page Unfocused..."),e}},TruncationModule={truncate:function(e,t=6,n=4){if("string"!=typeof e)throw new TypeError('TruncationModule.truncate: "string" must be a valid string but received '+typeof e);if(!Number.isInteger(t)||t<0)throw new RangeError(`TruncationModule.truncate: "startLength" must be a non-negative integer but received ${t}`);if(!Number.isInteger(n)||n<0)throw new RangeError(`TruncationModule.truncate: "endLength" must be a non-negative integer but received ${n}`);return e.length<=t+n+3?e:`${e.slice(0,t)}...${e.slice(-n)}`},truncateBalance:function(e,t=2,n=8){if("number"!=typeof e||isNaN(e))throw new TypeError(`TruncationModule.truncateBalance: "balance" must be a valid number but received ${e}`);if(!Number.isInteger(t)||t<0)throw new RangeError(`TruncationModule.truncateBalance: "decimals" must be a non-negative integer but received ${t}`);if(!Number.isInteger(n)||n<=0)throw new RangeError(`TruncationModule.truncateBalance: "maxLength" must be a positive integer but received ${n}`);const r=parseFloat(e);if(r>=1e15)return`${(r/1e15).toFixed(t)}Q`;if(r>=1e12)return`${(r/1e12).toFixed(t)}T`;if(r>=1e9)return`${(r/1e9).toFixed(t)}B`;if(r>=1e6)return`${(r/1e6).toFixed(t)}M`;if(r>=1e3)return`${(r/1e3).toFixed(t)}K`;const[o,i=""]=r.toString().split(".");if(o.length>=n)return o;const s=n-o.length-1,a=i.slice(0,Math.max(s,0));return a?`${o}.${a}`:o}},InterfaceModule={toggleLoader:function(e,t=!0,n,r=""){e&&(e.innerHTML=t?n:r)}},CHAINLINK_ABI=["function latestRoundData() view returns (uint80 roundId, int256 answer, uint256 startedAt, uint256 updatedAt, uint80 answeredInRound)"],ERC20_ABI=["function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 amount) returns (bool)","function balanceOf(address account) view returns (uint256)","function decimals() view returns (uint8)","function name() view returns (string)","function transfer(address to, uint256 amount) returns (bool)"],UNISWAP_V2_POOL_ABI=["function getReserves() view returns (uint112 _reserve0, uint112 _reserve1, uint32 _blockTimestampLast)","function token0() view returns (address)","function token1() view returns (address)","function totalSupply() view returns (uint256)","function balanceOf(address owner) view returns (uint256)","function allowance(address owner, address spender) view returns (uint256)","function approve(address spender, uint256 value) returns (bool)","function transfer(address to, uint256 value) returns (bool)","function transferFrom(address from, address to, uint256 value) returns (bool)"],UNISWAP_V3_POOL_ABI=["function slot0() view returns (uint160 sqrtPriceX96, int24 tick, uint16 observationIndex, uint16 observationCardinality, uint16 observationCardinalityNext, uint8 feeProtocol, bool unlocked)","function token0() view returns (address)","function token1() view returns (address)","function fee() view returns (uint24)","function decimals() view returns (uint8)","function liquidity() view returns (uint128)"],CHAINLINK_ADDRESSES={ethereum:"0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70",arbitrum:"0x639Fe6ab55C921f74e7fac1ee960C0B6293ba612",optimism:"0xb7B9A39CC63f856b90B364911CC324dC46aC1770",base:"0x71041dddad3595F9CEd3DcCFBe3D1F4b0a16Bb70"},CryptoModule={initCrypto:async function(e,t,n,r){const o=await this.getBalance(t);let i=null;"V2"===r&&(i=await this.getPriceV2(e,n)),"V3"===r&&(i=await this.getPriceV3(e,t,n));const s=await this.getUserValue(o,i);return console.log("Token Details: ",{tokenBalance:o,tokenPrice:i,userValue:s}),{tokenBalance:o,tokenPrice:i,userValue:s}},getETHPrice:async function(e){if(!window.ethereum)return null;if(!(e in CHAINLINK_ADDRESSES))return null;try{const t=CHAINLINK_ADDRESSES[e];if(!t)throw new Error(`Chain ${e} is not supported`);const n=new ethers.providers.Web3Provider(window.ethereum).getSigner(),r=new ethers.Contract(t,CHAINLINK_ABI,n),o=await r.latestRoundData(),i=ethers.utils.formatUnits(o.answer,8);return console.log(`ETH Price on ${e}: $${i}`),i}catch(e){return console.error("Error getting ETH price:",e),null}},getBalance:async function(e){if(!window.ethereum)return null;if(!e)return null;try{const t=new ethers.providers.Web3Provider(window.ethereum).getSigner(),n=await t.getAddress(),r=new ethers.Contract(e,ERC20_ABI,t),o=await r.balanceOf(n);return console.log(`Balance: ${o}`),o}catch(e){return console.error("Error getting balance:",e),null}},getPriceV2:async function(e,t){if(!window.ethereum)return null;if(!t)return null;if(!(e in CHAINLINK_ADDRESSES))return null;try{const n=await this.getETHPrice(e);if(!n)return null;const r=new ethers.providers.Web3Provider(window.ethereum).getSigner(),o=new ethers.Contract(t,UNISWAP_V2_POOL_ABI,r),i=await o.token0(),s=await o.token1(),a=await o.getReserves(),u=a._reserve0,l=a._reserve1,c=new ethers.Contract(i,ERC20_ABI,r),d=new ethers.Contract(s,ERC20_ABI,r),w=await c.decimals(),g=await d.decimals();console.log("Reserve 0:",u),console.log("Reserve 1:",l),console.log("Token 0:",i),console.log("Token 1:",s),console.log("Decimals 0:",w),console.log("Decimals 1:",g);const f=ethers.BigNumber.from(u),m=ethers.BigNumber.from(l),h=parseFloat(ethers.utils.formatUnits(f,w)),b=parseFloat(ethers.utils.formatUnits(m,g));let v;if(s.toLowerCase()===wethAddress.toLowerCase())v=b/h;else{if(i.toLowerCase()!==wethAddress.toLowerCase())return console.log(`Skipping pool ${t} - Neither token is WETH.`),null;v=h/b}const p=v*n;return console.log(`V2 Price for token in pool ${t}: ${p} USD`),p}catch(e){return console.error("Error calculating V2 token price:",e),null}},getPoolV3:async function(e,t){if(!window.ethereum)return null;if(!t||!e)return null;try{const e=new ethers.providers.Web3Provider(window.ethereum).getSigner(),n=new ethers.Contract(t,UNISWAP_V3_POOL_ABI,e),r=(await n.slot0()).sqrtPriceX96;console.log("Sqrt Price X96:",r);const o=await n.token0(),i=await n.token1();console.log("Token 0:",o),console.log("Token 1:",i);const s=new ethers.Contract(o,ERC20_ABI,e),a=new ethers.Contract(i,ERC20_ABI,e),u=await s.decimals(),l=await a.decimals();console.log("Decimals 0:",u),console.log("Decimals 1:",l);const c=await n.liquidity();return console.log("Liquidity:",c),{sqrtPriceX96:r,token0:o,token1:i,decimals0:u,decimals1:l,liquidity:c}}catch(e){return console.error("Error getting pool data:",e),null}},getPriceV3:async function(e,t,n){if(!window.ethereum)return null;if(!n||!t)return null;if(!(e in CHAINLINK_ADDRESSES))return null;try{const{sqrtPriceX96:r,token0:o,token1:i,decimals0:s,decimals1:a}=await this.getPoolV3(n,t),u=ethers.BigNumber.from(r),l=ethers.BigNumber.from("79228162514264337593543950336"),c=u.mul(u).mul(ethers.BigNumber.from(10).pow(s)),d=l.mul(l).mul(ethers.BigNumber.from(10).pow(a)),w=c.div(d),g=c.mod(d),f=8,m=ethers.BigNumber.from(10).pow(f),h=g.mul(m).div(d),b=parseFloat(w.toString())+parseFloat(h.toString())/Math.pow(10,f);let v;if(i.toLowerCase()===wethAddress.toLowerCase())v=b;else{if(o.toLowerCase()!==wethAddress.toLowerCase())return console.log(`Skipping pool ${n} - Neither token is WETH.`),null;v=1/b}const p=await this.getETHPrice(e);if(!p)return null;const C=v*parseFloat(p);return console.log(`V3 Price for token in pool ${n}: ${C} USD`),C}catch(e){return console.error("Error calculating V3 token price:",e),null}},getUserValue:async function(e,t){if(!e||!t)return null;try{const n=parseFloat(e)*parseFloat(t);return console.log(`User Value: ${n}`),n}catch(e){return console.error("Error calculating user value:",e),null}}};!function(e){const t={};Object.assign(t,WindowModule),Object.assign(t,TruncationModule),Object.assign(t,InterfaceModule),Object.assign(t,CryptoModule),e.sypher=t,console.log("sypher initialized:",t)}(window);